{"version":3,"file":"index.modern.js","sources":["../src/validation/regex.ts","../src/validation/schemas.ts","../src/types/httpMethod.ts","../src/routes/account/create.ts","../src/routes/account/user-exists.ts","../src/routes/account/login.ts","../src/routes/account/password/forgot.ts","../src/routes/account/password/reset.ts","../src/errors/index.ts"],"sourcesContent":["export namespace Regex {\n\t// Fiscal codes\n\texport const vat = /^[0-9]{11}$/;\n\texport const sdi = /^([0-9]|[A-Z]){6,7}$/;\n\texport const cf =\n\t\t/^(?:[A-Z][AEIOU][AEIOUX]|[AEIOU]X{2}|[B-DF-HJ-NP-TV-Z]{2}[A-Z]){2}(?:[\\dLMNP-V]{2}(?:[A-EHLMPR-T](?:[04LQ][1-9MNP-V]|[15MR][\\dLMNP-V]|[26NS][0-8LMNP-U])|[DHPS][37PT][0L]|[ACELMRT][37PT][01LM]|[AC-EHLMPR-T][26NS][9V])|(?:[02468LNQSU][048LQU]|[13579MPRTV][26NS])B[26NS][9V])(?:[A-MZ][1-9MNP-V][\\dLMNP-V]{2}|[A-M][0L](?:[1-9MNP-V][\\dLMNP-V]|[0L][1-9MNP-V]))[A-Z]$/;\n\n\t// Location\n\texport const provincia = /^[A-Z]{2}$/;\n\texport const cap = /^[0-9]{5}$/;\n\n\t// Contacts\n\texport const pec = /^(.*)@(?:\\w*\\.)*pec(?:\\.\\w+)+$/;\n\texport const phone = /^(\\+\\d{1,2}\\s)?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$/;\n\texport const url =\n\t\t/^(http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?$/;\n}\n","import * as yup from \"yup\";\nimport { Regex as re } from \"./regex\";\n\nexport namespace Schemas {\n\t/**\n\t * Basic schemas\n\t */\n\n\texport const url = yup.string().lowercase().matches(re.url);\n\n\texport const cf = yup.string().uppercase().matches(re.cf);\n\texport const vat = yup.string().matches(re.vat);\n\texport const sdi = yup.string().uppercase().matches(re.sdi);\n\n\texport const phone = yup.string().matches(re.phone);\n\texport const email = yup.string().email();\n\texport const pec = email.matches(re.pec);\n\n\texport const provincia = yup.string().uppercase().matches(re.provincia);\n\texport const cap = yup.string().matches(re.cap);\n\n\t/**\n\t * Yup dynamic checks\n\t */\n\n\texport function thenReq(value: boolean | string) {\n\t\treturn {\n\t\t\tis: value,\n\t\t\tthen: (schema: yup.AnySchema) => schema.required(),\n\t\t\totherwise: (schema: yup.AnySchema) => schema.nullable().optional(),\n\t\t};\n\t}\n\n\texport function thenUrlReq(value: boolean | string) {\n\t\treturn {\n\t\t\tis: value,\n\t\t\tthen: (schema: yup.AnySchema) => url.required(),\n\t\t\totherwise: (schema: yup.AnySchema) => schema.nullable().optional(),\n\t\t};\n\t}\n\n\texport function thenNull(value: boolean | string) {\n\t\treturn {\n\t\t\tis: value,\n\t\t\tthen: (schema: yup.AnySchema) => schema.nullable().optional(),\n\t\t\totherwise: (schema: yup.AnySchema) => schema.required(),\n\t\t};\n\t}\n\n\texport const nullOrReq = {\n\t\tis: (v: string | boolean | number) => v == true,\n\t\tthen: (s: yup.AnySchema) => s.nullable(),\n\t\totherwise: (s: yup.AnySchema) => s.required(),\n\t};\n}\n","export enum HTTPMethod {\n\tCONNECT = \"CONNECT\",\n\tDELETE = \"DELETE\",\n\tGET = \"GET\",\n\tHEAD = \"HEAD\",\n\tOPTIONS = \"OPTIONS\",\n\tPATCH = \"PATCH\",\n\tPOST = \"POST\",\n\tPUT = \"PUT\",\n\tTRACE = \"TRACE\",\n}\n","import * as yup from \"yup\";\nimport { Schemas } from \"../../validation\";\nimport { HTTPMethod, UsersPermissionsMe } from \"../../types\";\n\nexport namespace Create {\n\texport const path = \"/account/create\";\n\texport const method = HTTPMethod.POST;\n\n\texport interface Req {\n\t\tname: string;\n\t\tsurname: string;\n\t\temail: string;\n\t\tpassword: string;\n\t}\n\n\texport const values: Req = {\n\t\tname: \"\",\n\t\tsurname: \"\",\n\t\temail: \"\",\n\t\tpassword: \"\",\n\t};\n\n\texport const schema = yup\n\t\t.object({\n\t\t\tname: yup.string().required(),\n\t\t\tsurname: yup.string().required(),\n\t\t\temail: Schemas.email.required(),\n\t\t\tpassword: yup.string().required(),\n\t\t})\n\t\t.required();\n\n\texport interface Res extends UsersPermissionsMe {}\n}\n","import * as yup from \"yup\";\nimport { Schemas } from \"../../validation\";\nimport { HTTPMethod } from \"../../types\";\n\nexport namespace UserExists {\n\texport const path = \"/account/user-exists\";\n\texport const method = HTTPMethod.POST;\n\n\texport interface Req {\n\t\temail: string;\n\t}\n\n\texport const values: Req = {\n\t\temail: \"\",\n\t};\n\n\texport const schema = yup\n\t\t.object({\n\t\t\temail: Schemas.email.required(),\n\t\t})\n\t\t.required();\n\n\texport interface Res {\n\t\texists: boolean;\n\t}\n}\n","import * as yup from \"yup\";\nimport { Schemas } from \"../../validation\";\nimport { HTTPMethod, UsersPermissionsMe } from \"../../types\";\n\nexport namespace Login {\n\texport const path = \"/auth/local\";\n\texport const method = HTTPMethod.POST;\n\n\texport interface Req {\n\t\tidentifier: string;\n\t\tpassword: string;\n\t}\n\n\texport const values: Req = {\n\t\tidentifier: \"\",\n\t\tpassword: \"\",\n\t};\n\n\texport const schema = yup\n\t\t.object({\n\t\t\tidentifier: Schemas.email.required(),\n\t\t\tpassword: yup.string().required(),\n\t\t})\n\t\t.required();\n\n\texport interface Res {\n\t\tuser: UsersPermissionsMe;\n\t\tjwt: string;\n\t}\n}\n","import * as yup from \"yup\";\nimport { Schemas } from \"../../../validation\";\nimport { HTTPMethod } from \"../../../types\";\n\nexport namespace Forgot {\n\texport const path = \"/auth/forgot-password\";\n\texport const method = HTTPMethod.POST;\n\n\texport interface Req {\n\t\temail: string;\n\t}\n\n\texport const values: Req = {\n\t\temail: \"\",\n\t};\n\n\texport const schema = yup\n\t\t.object({\n\t\t\temail: Schemas.email.required(),\n\t\t})\n\t\t.required();\n\n\texport interface Res {\n\t\tok: boolean;\n\t\t// Also, there's a redirection\n\t\t// The url has a code needed for the reset\n\t}\n}\n","import * as yup from \"yup\";\nimport { HTTPMethod, UsersPermissionsMe } from \"../../../types\";\n\nexport namespace Reset {\n\texport const path = \"/auth/reset-password\";\n\texport const method = HTTPMethod.POST;\n\n\texport interface Req {\n\t\tpassword: string;\n\t\tpasswordConfirmation: string;\n\t\tcode: string;\n\t}\n\n\texport const values: Req = {\n\t\tpassword: \"string\",\n\t\tpasswordConfirmation: \"string\",\n\t\tcode: \"string\",\n\t};\n\n\texport const schema = yup\n\t\t.object({\n\t\t\tpassword: yup.string().required(),\n\t\t\tpasswordConfirmation: yup.string().required(),\n\t\t\tcode: yup.string().required(),\n\t\t})\n\t\t.required();\n\n\texport interface Res {\n\t\tuser: UsersPermissionsMe;\n\t\tjwt: string;\n\t}\n}\n","export const errors = {\n\tpolicies: {\n\t\tnoSchemaInConfig: \"noSchemaInConfig\",\n\t\tbodyNotValid: \"bodyNotValid\",\n\t},\n\t// AlreadyEnrolled: \"AlreadyEnrolled\",\n\t// BadPolicyConfig: \"BadPolicyConfig\",\n\t// DefaultRoleNotFound: \"DefaultRoleNotFound\",\n\t// EmailSendError: \"EmailSendError\",\n\t// EmailTaken: \"EmailTaken\",\n\t// EnrollmentExpired: \"EnrollmentExpired\",\n\t// InternalServerError: \"InternalServerError\",\n\t// InvalidRequestBody: \"InvalidRequestBody\",\n\t// InvalidRole: \"InvalidRole\",\n\t// MissingCourseID: \"MissingCourseID\",\n\t// MissingUserInfo: \"MissingUserInfo\",\n\t// NoSchemaProvidedInPolicyConfig: \"NoSchemaProvidedInPolicyConfig\",\n\t// NotFound: \"NotFound\",\n\t// PasswordThreeDollars: \"PasswordThreeDollars\",\n\t// PaymentAlreadyConfirmed: \"PaymentAlreadyConfirmed\",\n\t// PaymentAlreadyPaid: \"PaymentAlreadyPaid\",\n\t// PaymentExpired: \"PaymentExpired\",\n\t// PaymentNotFound: \"PaymentNotFound\",\n\t// RegisterDisabled: \"RegisterDisabled\",\n\t// UnknownError: \"UnknownError\",\n\t// UserExists: \"UserExists\",\n\t// UserNotConfirmed: \"UserNotConfirmed\",\n\t// UserNotFound: \"UserNotFound\",\n\t// ValidationError: \"ValidationError\",\n};\n"],"names":["Regex","vat","sdi","cf","provincia","cap","pec","phone","url","Schemas","yup","string","lowercase","matches","re","uppercase","email","thenReq","value","is","then","schema","required","otherwise","nullable","optional","thenUrlReq","thenNull","nullOrReq","v","s","HTTPMethod","Create","path","method","POST","values","name","surname","password","object","UserExists","Login","identifier","Forgot","Reset","passwordConfirmation","code","errors","policies","noSchemaInConfig","bodyNotValid"],"mappings":"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"}